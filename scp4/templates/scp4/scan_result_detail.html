{% extends 'scp4/base.html' %} {# **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß: ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ä‡πâ 'scp4/base.html'** #}

{# ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ {% load static %} ‡∏ã‡πâ‡∏≥‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ base.html ‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß #}

{% block title %}‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡πâ‡∏î - Code Scan Pro{% endblock %}

{% block extra_head %}
{# ‡πÉ‡∏™‡πà CSS ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô head ‡∏Ç‡∏≠‡∏á HTML ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏£‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô block extra_head ‡πÉ‡∏ô base.html #}
<style>
    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÇ‡∏ó‡∏ô‡πÄ‡∏Ç‡πâ‡∏° - ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡πâ‡∏≥ ‡∏´‡∏≤‡∏Å body ‡πÉ‡∏ô base.html ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏•‡πâ‡∏ß */
    /* ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏£‡∏î‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà */
    /* body {
        background-color: #121212;
        color: #e0e0e0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px 40px;
    } */

    /* ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ */
    h1, h2 {
        color: #81c784; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô */
        font-weight: 700;
        margin-bottom: 20px;
    }

    /* ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏Ñ‡πâ‡∏î */
    pre {
        background: #1e1e1e;
        padding: 20px;
        border-radius: 8px;
        overflow-x: auto;
        font-family: 'Fira Code', monospace; /* ‡πÉ‡∏ä‡πâ Fira Code ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô base.html */
        font-size: 1rem;
        box-shadow: 0 0 10px rgba(56, 142, 60, 0.53); /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ alpha ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á */
        color: #a5d6a7;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å - ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö base.html ‡∏´‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ class ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô */
    /* ‡∏ñ‡πâ‡∏≤ base.html ‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏° CSS ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ class ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô */
    .btn {
        display: inline-block;
        background: #388e3c;
        color: #f0f0f0;
        padding: 10px 18px;
        margin: 6px 8px 6px 0;
        border-radius: 6px;
        font-weight: 600;
        text-decoration: none;
        box-shadow: 0 3px 6px rgba(56,142,60,0.6);
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
    }
    .btn:hover {
        background: #2e7d32;
        box-shadow: 0 5px 15px rgba(46,125,50,0.8);
    }

    .btn-danger {
        background: #d32f2f;
        box-shadow: 0 3px 6px rgba(211,47,47,0.6);
    }
    .btn-danger:hover {
        background: #b71c1c;
        box-shadow: 0 5px 15px rgba(183,28,28,0.8);
    }

    .btn-primary {
        background: #1976d2;
        box-shadow: 0 3px 6px rgba(25,118,210,0.6);
    }
    .btn-primary:hover {
        background: #1565c0;
        box-shadow: 0 5px 15px rgba(21,101,192,0.8);
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô */
    .current-page-indicator {
        background: #81c784;
        color: #121212;
        cursor: default;
        box-shadow: none;
    }

    /* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ */
    ul {
        list-style: none;
        padding-left: 0;
    }
    .history-list-item {
        background: #1f1f1f;
        margin-bottom: 16px;
        padding: 18px 24px;
        border-radius: 10px;
        color: #cfd8dc;
        box-shadow: 0 4px 8px rgba(0,0,0,0.6);
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        transition: box-shadow 0.3s ease;
    }
    .history-list-item:hover {
        box-shadow: 0 8px 20px rgba(56,142,60,0.9);
    }
    .current-scan-highlight {
        border-left: 6px solid #81c784;
        background: rgba(44,111,74,0.13); /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÉ‡∏™‡πÜ */
    }
    .history-checkbox-wrapper {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .history-checkbox {
        transform: scale(1.3);
        cursor: pointer;
        filter: invert(1);
    }
    .scan-info-text {
        font-size: 0.95rem;
    }

    /* ‡∏™‡∏µ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà */
    .vuln-high {
        color: #ef5350; /* ‡πÅ‡∏î‡∏á‡∏™‡∏î */
        font-weight: 700;
    }
    .vuln-medium {
        color: #ffb74d; /* ‡∏™‡πâ‡∏°‡∏ó‡∏≠‡∏á */
        font-weight: 700;
    }
    .vuln-none {
        color: #81c784; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        font-weight: 700;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÅ‡∏•‡∏∞ PDF */
    .view-details-btn, .export-pdf-btn {
        margin-left: 12px;
    }

    /* ‡πÅ‡∏ñ‡∏ö‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
    .delete-options {
        margin-bottom: 30px;
        display: flex; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏Å‡∏±‡∏ô */
        gap: 10px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° */
    }

    /* ‡∏™‡πà‡∏ß‡∏ô export ‡∏õ‡∏∏‡πà‡∏° */
    .export-buttons {
        margin: 20px 0 40px 0;
        display: flex; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏Å‡∏±‡∏ô */
        gap: 10px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° */
    }

    hr {
        border-color: #444;
        margin-top: 40px;
    }
</style>
{% endblock %}

{% block content %}
{# ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏£‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô block content ‡πÉ‡∏ô base.html #}
<h1 style="color: #81c784;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡πâ‡∏î</h1>

<pre>{{ code }}</pre>

{% include "scp4/partials/analysis_result.html" with {# **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß: ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ä‡πâ 'scp4/partials/analysis_result.html'** #}
    scan_result=scan_result
    code=code
    raw_output_text=raw_output_text
    no_vuln_found=no_vuln_found
    ollama_error=ollama_error
    vulnerabilities=vulnerabilities %}

<div class="export-buttons">
    <a href="{% url 'scp4:index' %}" class="btn back-to-scan">üîô ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡∏°‡πà</a>
</div>

<hr>

<h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>

<div class="delete-options">
    <button id="delete-selected-button" class="btn btn-primary" disabled>üóëÔ∏è ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
    <form id="clear-all-form" action="{% url 'scp4:clear_scan_history' %}" method="post" onsubmit="return confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!');" style="margin: 0;">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </form>
</div>

{% if scan_results %}
<ul>
    {% for result in scan_results|dictsortreversed:"scanned_at" %}
    <li class="history-list-item {% if result.id == current_scan_id %}current-scan-highlight{% endif %}"
        data-scan-id="{{ result.id }}">
        <div class="history-checkbox-wrapper">
            <input type="checkbox" class="history-checkbox" value="{{ result.id }}">
            <div>
                <span class="scan-info-text" style="color: #81c784; font-weight: bold;">üóìÔ∏è {{ result.scanned_at|date:"d M Y H:i:s" }}</span><br>
                <span class="scan-info-text">‡∏û‡∏ö‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà:
                    <strong class="{% if result.high_severity_count > 0 %}vuln-high{% elif result.total_vulnerabilities > 0 %}vuln-medium{% else %}vuln-none{% endif %}">
                        {{ result.total_vulnerabilities }}
                    </strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </span>
            </div>
        </div>
        <div style="margin-top: 10px;">
            {% if result.id != current_scan_id %}
            <a href="{% url 'scp4:view_scan_result' result.id %}" class="btn view-details-btn">üëÅÔ∏è ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</a>
            {% else %}
            <span class="btn current-page-indicator">‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</span>
            {% endif %}
            <a href="{% url 'scp4:export_scan_report_pdf' result.id %}" target="_blank" class="btn export-pdf-btn">‚¨áÔ∏è PDF</a>
        </div>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏•‡∏¢!</p>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const checkboxes = document.querySelectorAll('.history-checkbox');
        const deleteButton = document.getElementById('delete-selected-button');

        function updateDeleteButtonState() {
            const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            deleteButton.disabled = checkedCount === 0;
        }

        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateDeleteButtonState);
        });

        deleteButton.addEventListener('click', function() {
            const selectedIds = Array.from(checkboxes)
                .filter(cb => cb.checked)
                .map(cb => cb.value);

            if (selectedIds.length > 0) {
                if (confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${selectedIds.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å?`)) {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '{% url "scp4:delete_selected_scans" %}'; 

                    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
                    const csrfTokenInput = document.createElement('input');
                    csrfTokenInput.type = 'hidden';
                    csrfTokenInput.name = 'csrfmiddlewaretoken';
                    csrfTokenInput.value = csrfToken;
                    form.appendChild(csrfTokenInput);

                    selectedIds.forEach(id => {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = 'scan_ids';
                        input.value = id;
                        form.appendChild(input);
                    });

                    document.body.appendChild(form);
                    form.submit();
                }
            }
        });

        updateDeleteButtonState();
    });
</script>
{% endblock %}